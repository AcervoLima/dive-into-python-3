<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iteradores avançados</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>
<body>

    <h1>Iteradores avançados</h1>
    <blockquote>
        <p>
            ❝Grandes pulgas têm pequenas pulgas nas costas para mordê-las, <br/>
            E pequenas pulgas têm pulgas menores, e assim ad infinitum.❞<br/>
             - Augustus De Morgan
        </p>
    </blockquote>
    <h2 id="divingin">Mergulho</h2>
    <p>
        Assim como <a href="https://www.acervolima.com.br/2021/05/expressoes-regulares-em-python.html">as expressões regulares</a> colocam <a href="https://www.acervolima.com.br/2021/05/strings-em-python-3.html">strings</a> em esteróides, o módulo <code>itertools</code> coloca <a href="https://www.acervolima.com.br/2021/05/classes-e-iteradores-em-python.html">iteradores</a> em esteróides. Mas, primeiro, quero mostrar um quebra-cabeça clássico.
    </p>
    <pre class="output">HAWAII + IDAHO + IOWA + OHIO == STATES
510199 + 98153 + 9301 + 3593 == 621246

H = 5
A = 1
W = 0
I = 9
D = 8
O = 3
S = 6
T = 2
E = 4</pre>

    <p>
        Enigmas como este são chamados <i>cryptarithms</i> ou <i>alphametics</i>. As letras formam palavras reais, mas se você substituir cada letra por um dígito de <code>0–9</code>, também “soletra” uma equação aritmética. O truque é descobrir qual letra mapeia para cada dígito. Todas as ocorrências de cada letra devem ser mapeadas para o mesmo dígito, nenhum dígito pode ser repetido e nenhuma “palavra” pode começar com o dígito 0.
    </p>
    <blockquote>
        <p>
          O quebra-cabeça alfamético mais conhecido é <code>SEND + MORE = MONEY</code>.
        </p>

    </blockquote>
    <p>
        Neste capítulo, vamos mergulhar em um programa Python incrível originalmente escrito por Raymond Hettinger. Este programa resolve quebra-cabeças alfaméticos <em>em apenas 14 linhas de código</em>.
    </p>

    <pre><code class="language-python">import re
import itertools

def solve(puzzle):
    words = re.findall('[A-Z]+', puzzle.upper())
    unique_characters = set(''.join(words))
    assert len(unique_characters) &lt;= 10, 'Too many letters'
    first_letters = {word[0] for word in words}
    n = len(first_letters)
    sorted_characters = ''.join(first_letters) + \
        ''.join(unique_characters - first_letters)
    characters = tuple(ord(c) for c in sorted_characters)
    digits = tuple(ord(c) for c in '0123456789')
    zero = digits[0]
    for guess in itertools.permutations(digits, len(characters)):
        if zero not in guess[:n]:
            equation = puzzle.translate(dict(zip(characters, guess)))
            if eval(equation):
                return equation

if __name__ == '__main__':
    import sys
    for puzzle in sys.argv[1:]:
        print(puzzle)
        solution = solve(puzzle)
        if solution:
            print(solution)</code></pre>

    <p id="postautopre0">
        Você pode executar o programa a partir da linha de comando. No Linux, seria assim. (Isso pode levar algum tempo, dependendo da velocidade do seu computador, e não há barra de progresso. Seja paciente!).
    </p>
    
    <pre>you@localhost:~/diveintopython3/examples$ python3 alphametics.py "HAWAII + IDAHO + IOWA + OHIO == STATES"
HAWAII + IDAHO + IOWA + OHIO = STATES
510199 + 98153 + 9301 + 3593 == 621246
you@localhost:~/diveintopython3/examples$ python3 alphametics.py "I + LOVE + YOU == DORA"
I + LOVE + YOU == DORA
1 + 2784 + 975 == 3760
you@localhost:~/diveintopython3/examples$ python3 alphametics.py "SEND + MORE == MONEY"
SEND + MORE == MONEY
9567 + 1085 == 10652</pre>

    <h2 id="re-findall">Encontrar todas as ocorrências de um padrão</h2>
    <p>
        A primeira coisa que esse solucionador de alfamética faz é encontrar todas as letras (A–Z) do quebra-cabeça.
    </p>
    
    <pre><code class="python-repl">>>> import re
>>> re.findall('[0-9]+', '16 2-by-4s in rows of 8')  ①
['16', '2', '4', '8']
>>> re.findall('[A-Z]+', 'SEND + MORE == MONEY')     ②
['SEND', 'MORE', 'MONEY']</code></pre>

    <ol>
      <li>
          O módulo <code>re</code> é a implementação de <a href="https://www.acervolima.com.br/2021/05/expressoes-regulares-em-python.html">expressões regulares em Python</a>. Ele tem uma função bacana chamada <code>findall()</code> que pega um padrão de expressão regular e uma string e encontra todas as ocorrências do padrão dentro da string. Nesse caso, o padrão corresponde a sequências de números. A função <code>findall()</code> retorna uma lista de todas as substrings que corresponderam ao padrão.
      </li>
      <li>
          Aqui, o padrão de expressão regular corresponde a sequências de letras. Novamente, o valor de retorno é uma lista e cada item da lista é uma string que corresponde ao padrão de expressão regular.
      </li>
    </ol>
    <p>
        Aqui está outro exemplo que vai esticar um pouco o seu cérebro.
    </p>
    
    <pre><code class="language-python-repl">>>> re.findall(' s.*? s', "The sixth sick sheikh's sixth sheep's sick.")
[' sixth s', " sheikh's s", " sheep's s"]</code></pre>

    <blockquote>
        <p>
            Este é o <a href="http://en.wikipedia.org/wiki/Tongue-twister" target="_blank">trava-língua mais difícil da língua inglesa </a>.
        </p>
    </blockquote>
    <p>
        Surpreso? A expressão regular procura um espaço, um <code>s</code> e, a seguir, a menor série possível de qualquer caractere (<code>.*?</code>), depois um espaço e depois outro <code>s</code>. Bem, olhando para aquela string de entrada, vejo cinco correspondências:
    </p>
    <ol>
        <li><code>The<mark> sixth s</mark>ick sheikh's sixth sheep's sick.</code></li>
        <li><code>The sixth<mark> sick s</mark>heikh's sixth sheep's sick.</code></li>
        <li><code>The sixth sick<mark> sheikh's s</mark>ixth sheep's sick.</code></li>
        <li><code>The sixth sick sheikh's<mark> sixth s</mark>heep's sick.</code></li>
        <li><code>The sixth sick sheikh's sixth<mark> sheep's s</mark>ick.</code></li>
    </ol>
    <p>
        Mas a função <code>re.findall()</code> retornou apenas três correspondências. Especificamente, ele retornou o primeiro, o terceiro e o quinto. Por que isso? Porque <em>ele não retorna correspondências sobrepostas</em>. A primeira correspondência se sobrepõe à segunda, portanto, a primeira é retornada e a segunda é ignorada. Em seguida, o terceiro se sobrepõe ao quarto, de modo que o terceiro é retornado e o quarto é ignorado. Finalmente, o quinto é devolvido. Três partidas, não cinco.
    </p>
    <p>
        Isso não tem nada a ver com o solucionador de alfamética; Eu só pensei que isso era interessante.
    </p>
    
    <h2 id="unique-items">Encontrar os itens exclusivos em uma sequência</h2>
    <p>
        <a href="https://www.acervolima.com.br/2021/05/tipos-de-dados-nativos-em-python.html#sets">Os conjuntos</a> tornam trivial encontrar os itens exclusivos em uma sequência.
    </p>
    
    <pre><code class="language-python-repl">>>> a_list = ['The', 'sixth', 'sick', "sheik's", 'sixth', "sheep's", 'sick']
>>> set(a_list)                      ①
{'sixth', 'The', "sheep's", 'sick', "sheik's"}
>>> a_string = 'EAST IS EAST'
>>> set(a_string)                    ②
{'A', ' ', 'E', 'I', 'S', 'T'}
>>> words = ['SEND', 'MORE', 'MONEY']
>>> ''.join(words)                   ③
'SENDMOREMONEY'
>>> set(''.join(words))              ④
{'E', 'D', 'M', 'O', 'N', 'S', 'R', 'Y'}</code></pre>

    <ol>
        <li>
          Dada uma lista de várias strings, a função <code>set()</code> retornará um conjunto de strings exclusivas da lista. Isso faz sentido se você pensar nisso como um loop <code>for</code>. Pegue o primeiro item da lista e coloque-o no conjunto. Segundo. Terceiro. Quarto. Quinto - espere, isso já está no conjunto, então só é listado uma vez, porque os conjuntos Python não permitem duplicatas. Sexto. Sétimo - novamente, uma duplicata, portanto, só é listada uma vez. O resultado final? Todos os itens exclusivos da lista original, sem duplicatas. A lista original nem precisa ser classificada primeiro.
        </li>
        <li>
            A mesma técnica funciona com strings, já que uma string é apenas uma sequência de caracteres.
        </li>
        <li>
            Dada uma lista de strings, <code>''.join(a_list)</code> concatena todas as strings em uma.
        </li>
        <li>
            Portanto, dada uma lista de strings, essa linha de código retorna todos os caracteres exclusivos em todas as strings, sem duplicatas.
        </li>
    </ol>
    <p>
        O solucionador de alfamética usa essa técnica para construir um conjunto de todos os caracteres únicos do quebra-cabeça.
    </p>
    
    <pre><code class="language-python">unique_characters = set(''.join(words))</code></pre>

    <p>
        Esta lista é usada posteriormente para atribuir dígitos aos caracteres à medida que o solucionador itera através das soluções possíveis.
    </p>
    
    <h2 id="assert">Fazendo afirmações</h2>
    <p>
        Como muitas linguagens de programação, Python tem uma declaração <code>assert</code>. É assim que funciona.
    </p>
    
    <pre><code class="language-python-repl">>>> assert 1 + 1 == 2                                     ①
>>> assert 1 + 1 == 3                                     ②
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AssertionError
>>> assert 2 + 2 == 5, "Only for very large values of 2"  ③
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AssertionError: Only for very large values of 2</code></pre>

    <ol>
        <li>
            A instrução <code>assert</code> é seguida por qualquer expressão Python válida. Neste caso, a expressão avalia <code>1 + 1 == 2</code> para <code>True</code>, então a instrução <code>assert</code> não faz nada.
        </li>
        <li>
            No entanto, se a expressão Python for avaliada como <code>False</code>, a instrução <code>assert</code> gerará um <code>AssertionError</code>.
        </li>
        <li>
            Você também pode incluir uma mensagem legível que será impressa se a exceção <code>AssertionError</code> for gerado.
        </li>
    </ol>
    <p>
        Portanto, esta linha de código:
    </p>
    
    <pre><code class="language-python">assert len(unique_characters) &lt;= 10, 'Too many letters'</code></pre>

    <p>
        ... é equivalente a isto:
    </p>
    
    <pre><code class="language-python-repl">if len(unique_characters) > 10:
    raise AssertionError('Too many letters')</code></pre>

    <p>
        O solucionador de alfamética usa exatamente isso <code>assert</code> afirmação para escapar mais cedo se o quebra-cabeça contiver mais de dez letras únicas. Uma vez que cada letra é atribuída a um dígito único, e há apenas dez dígitos, um quebra-cabeça com mais de dez letras exclusivas não pode ter uma solução.
    </p>
    
    <h2 id="generator-expressions">Expressões geradoras</h2>
    <p>
        Uma expressão geradora é como uma <a href="https://www.acervolima.com.br/2021/05/closures-e-geradores-em-python.html">função geradora</a> sem a função.
    </p>
    
    <pre><code class="language-python-repl">>>> unique_characters = {'E', 'D', 'M', 'O', 'N', 'S', 'R', 'Y'}
>>> gen = (ord(c) for c in unique_characters)  ①
>>> gen                                        ②
<generator object <genexpr> at 0x00BADC10>
>>> next(gen)                                  ③
69
>>> next(gen)
68
>>> tuple(ord(c) for c in unique_characters)   ④
(69, 68, 77, 79, 78, 83, 82, 89)</code></pre>

    <ol>
        <li>
            Uma expressão geradora é como uma função anônima que produz valores. A expressão em si parece uma <a href="https://www.acervolima.com.br/2021/05/compreensoes-de-listas-dicionarios-e.html#listcomprehension">compreensão de lista</a>, mas está entre parênteses em vez de colchetes.
        </li>
        <li>
            A expressão geradora retorna... um iterador.
        </li>
        <li>
            Chamar <code>next(gen)</code> retorna o próximo valor do iterador.
        </li>
        <li>
            Se você gosta, você pode percorrer todos os valores possíveis e retornar uma tupla, lista ou conjunto, passando a expressão geradora <code>tuple()</code>, <code>list()</code> ou <code>set()</code>. Nesses casos, você não precisa de um conjunto extra de parênteses - apenas passe a expressão “nua” <code>ord(c) for c in unique_characters</code> para a função <code>tuple()</code> e o Python descobrirá que é uma expressão geradora.
        </li>
    </ol>
    <div class="admonition note">
        <p class="admonition-title">Observação</p>
        <p>
            Usar uma expressão geradora em vez de uma compreensão de lista pode economizar CPU e RAM. Se você estiver construindo uma lista apenas para jogá-la fora (<i>por exemplo,</i> passando-a para <code>tuple()</code> ou <code>set()</code>), use uma expressão geradora!
        </p>
    </div>
    <p>
        Esta é outra maneira de realizar a mesma coisa, usando uma <a href="https://www.acervolima.com.br/2021/05/closures-e-geradores-em-python.html" style="color: #b44582;">função geradora</a>:
    </p>
    
    <pre><code class="language-python">def ord_map(a_string):
    for c in a_string:
        yield ord(c)

gen = ord_map(unique_characters)</code></pre>

    <p>
        A expressão geradora é mais compacta, mas funcionalmente equivalente.
    </p>
    
    <h2 id="permutations">Calculando Permutações... O Caminho Preguiçoso!</h2>
    <p>
        Em primeiro lugar, o que diabos são permutações? As permutações são um conceito matemático. (Na verdade, existem várias definições, dependendo do tipo de matemática que você está fazendo. Aqui estou falando sobre combinatória, mas se isso não significa nada para você, não se preocupe com isso. Como sempre, a <a href="http://en.wikipedia.org/wiki/Permutation" target="_blank">Wikipedia é o seu amigo</a>).
    </p>
    <p>
        A ideia é que você pegue uma lista de coisas (podem ser números, podem ser letras, podem ser ursos dançarinos) e encontre todas as maneiras possíveis de dividi-las em listas menores. Todas as listas menores têm o mesmo tamanho, que pode ser tão pequeno quanto 1 e tão grande quanto o número total de itens. Ah, e nada pode ser repetido. Os matemáticos dizem coisas como “vamos encontrar as permutações de 3 itens diferentes tomados 2 de cada vez”, o que significa que você tem uma sequência de 3 itens e deseja encontrar todos os pares ordenados possíveis.
    </p>
    
    <pre><code class="language-python-repl">>>> import itertools                              ①
>>> perms = itertools.permutations([1, 2, 3], 2)  ②
>>> next(perms)                                   ③
(1, 2)
>>> next(perms)
(1, 3)
>>> next(perms)
(2, 1)                                            ④
>>> next(perms)
(2, 3)
>>> next(perms)
(3, 1)
>>> next(perms)
(3, 2)
>>> next(perms)                                   ⑤
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
StopIteration</code></pre>

    <ol>
        <li>
            O módulo <code>itertools</code> contém todos os tipos de coisas divertidas, incluindo uma função <code>permutations()</code> que faz todo o trabalho árduo de encontrar permutações.
        </li>
        <li>
            A função <code>permutations()</code> leva uma sequência (aqui uma lista de três inteiros) e um número, que é o número de itens que você deseja em cada grupo menor. A função retorna um iterador, que você pode usar em um loop <code>for</code> ou em qualquer lugar antigo que itere. Aqui, percorrerei o iterador manualmente para mostrar todos os valores.
        </li>
        <li>
            A primeira permutação de <code>[1, 2, 3]</code> tomada 2 de cada vez é <code>(1, 2)</code>.
        </li>
        <li>
            Observe que as permutações são ordenadas: <code>(2, 1)</code> é diferente de <code>(1, 2)</code>.
        </li>
        <li>
            É isso! Essas são todas as permutações de <code>[1, 2, 3]</code> tomada 2 de cada vez. Os pares como <code>(1, 1)</code> e <code>(2, 2)</code> nunca aparecem, porque contêm repetições, portanto não são permutações válidas. Quando não há mais permutações, o iterador levanta uma exceção <code>StopIteration</code>.
        </li>
    </ol>
    <blockquote>
        <p>
            O módulo <code>itertools</code> tem todo tipo de diversão.
        </p>
    </blockquote>
    <p>
        A função <code>permutations()</code> não precisa de uma lista. Pode receber qualquer sequência - até mesmo uma string.
    </p>
    
    <pre><code class="language-python-repl">>>> import itertools
>>> perms = itertools.permutations('ABC', 3)  ①
>>> next(perms)
('A', 'B', 'C')                               ②
>>> next(perms)
('A', 'C', 'B')
>>> next(perms)
('B', 'A', 'C')
>>> next(perms)
('B', 'C', 'A')
>>> next(perms)
('C', 'A', 'B')
>>> next(perms)
('C', 'B', 'A')
>>> next(perms)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
StopIteration
>>> list(itertools.permutations('ABC', 3))    ③
[('A', 'B', 'C'), ('A', 'C', 'B'),
 ('B', 'A', 'C'), ('B', 'C', 'A'),
 ('C', 'A', 'B'), ('C', 'B', 'A')]</code></pre>

    <ol>
        <li>
            Uma string é apenas uma sequência de caracteres. Para fins de localização de permutações, a string <code>'ABC'</code> é equivalente à lista <code>['A', 'B', 'C']</code>.
        </li>
        <li>
            A primeira permutação dos 3 itens <code>['A', 'B', 'C']</code>, considerados 3 de cada vez, é <code>('A', 'B', 'C')</code>. Existem cinco outras permutações - os mesmos três caracteres em todas as ordens concebíveis.
        </li>
        <li>
            Como a função <code>permutations()</code> sempre retorna um iterador, uma maneira fácil de depurar permutações é passar esse iterador para a função <code>list()</code> interna para ver todas as permutações imediatamente.
        </li>
    </ol>

    <h2 id="more-itertools">Outras coisas divertidas no módulo <code>itertools</code></h2>

    <pre><code class="language-python-repl">>>> import itertools
>>> list(itertools.product('ABC', '123'))   ①
[('A', '1'), ('A', '2'), ('A', '3'), 
 ('B', '1'), ('B', '2'), ('B', '3'), 
 ('C', '1'), ('C', '2'), ('C', '3')]
>>> list(itertools.combinations('ABC', 2))  ②
[('A', 'B'), ('A', 'C'), ('B', 'C')]</code></pre>

    <ol>
        <li>
            A função <code>itertools.product()</code> retorna um iterador contendo o produto cartesiano de duas sequências.
        </li>
        <li>
            A função <code>itertools.combinations()</code> retorna um iterador contendo todas as combinações possíveis da sequência fornecida com o comprimento fornecido. É como a função <code>itertools.permutations()</code>, exceto que as combinações não incluem itens que são duplicatas de outros itens em uma ordem diferente. Portanto <code>itertools.permutations('ABC', 2)</code>, retornará ambos <code>('A', 'B')</code> e <code>('B', 'A')</code>(entre outros), mas <code>itertools.combinations('ABC', 2)</code> não retornará <code>('B', 'A')</code> porque é uma duplicata de <code>('A', 'B')</code> em uma ordem diferente.
        </li>
    </ol>

<p class="skip"><a href="#postautopre8" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre8"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre8')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre8')" style="color: #b44582;">abrir em uma nova janela</a> ] [ <a href="examples/favorite-people.txt" style="color: #b44582;">baixar<code>favorite-people.txt</code></a> ]
</div><div class="b"><a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">open</span><span class="pun">(</span><span class="str">'examples/favorite-people.txt'</span><span class="pun">,</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">'utf-8'</span><span class="pun">))</span></kbd>  <span class="u">①</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="str">'Dora \ n' </span><span class="pun">, </span><span class="str">'Ethan \ n' </span><span class="pun">, </span><span class="str">'Wesley \ n' </span><span class="pun">, </span><span class="str">'John \ n' </span><span class="pun">, </span><span class="str">'Anne \ n' </span><span class="pun">, </span><span class="str">'Mike \ n' </span><span class="pun">, </span><span class="str">'Chris \ n' </span><span class="pun">, </span><span class="str">'Sarah \ n' </span><span class="pun">, </span><span class="str">' Alex \ n ' </span><span class="pun">, </span><span class="str">' Lizzie \ n ' </span><span class="pun">]</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"><br/></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">.</span><span class="pln">rstrip</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> name </span><span class="kwd">in</span><span class="pln"> names</span><span class="pun">]</span></kbd>                             <span class="u">②</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="str">'Dora' </span><span class="pun">, </span><span class="str">'Ethan' </span><span class="pun">, </span><span class="str">'Wesley' </span><span class="pun">, </span><span class="str">'John' </span><span class="pun">, </span><span class="str">'Anne' </span><span class="pun">, </span><span class="str">'Mike' </span><span class="pun">, </span><span class="str">'Chris' </span><span class="pun">, </span><span class="str">'Sarah' </span><span class="pun">, </span><span class="str">'Alex' </span><span class="pun">, </span><span class="str">'Lizzie' </span><span class="pun">]</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"><br/></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names </span><span class="pun">=</span><span class="pln"> sorted</span><span class="pun">(</span><span class="pln">names</span><span class="pun">)</span></kbd>                                                 <span class="u">③</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="str">'Alex' </span><span class="pun">, </span><span class="str">'Anne' </span><span class="pun">, </span><span class="str">'Chris' </span><span class="pun">, </span><span class="str">'Dora' </span><span class="pun">, </span><span class="str">'Ethan' </span><span class="pun">, </span><span class="str">'John' </span><span class="pun">, </span><span class="str">'Lizzie' </span><span class="pun">, </span><span class="str">'Mike' </span><span class="pun">, </span><span class="str">'Sarah' </span><span class="pun">, </span><span class="str">'Wesley' </span><span class="pun">]</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"><br/></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names </span><span class="pun">=</span><span class="pln"> sorted</span><span class="pun">(</span><span class="pln">names</span><span class="pun">,</span><span class="pln"> key</span><span class="pun">=</span><span class="pln">len</span><span class="pun">)</span></kbd>                                        <span class="u">④</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">names</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="str">'Alex' </span><span class="pun">, </span><span class="str">'Anne' </span><span class="pun">, </span><span class="str">'Dora' </span><span class="pun">, </span><span class="str">'John' </span><span class="pun">, </span><span class="str">'Mike' </span><span class="pun">, </span><span class="str">'Chris' </span><span class="pun">, </span><span class="str">'Ethan' </span><span class="pun">, </span><span class="str">'Sarah' </span><span class="pun">, </span><span class="str">'Lizzie' </span><span class="pun">, </span><span class="str">'Wesley' </span><span class="pun">]</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"><br/></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Este idioma retorna uma lista das linhas em um arquivo de texto.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Infelizmente (para este exemplo), o idioma também inclui os retornos de carro no final de cada linha. Esta compreensão de lista usa o método string para retirar os espaços em branco à direita de cada linha. (Strings também têm um método para remover os espaços em branco iniciais e um método que remove os dois.)
<code>list(open(<var>filename</var>))</code><code>rstrip()</code><code>lstrip()</code><code>strip()</code></td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A <code>sorted()</code>função pega uma lista e a retorna classificada. Por padrão, ele é classificado em ordem alfabética.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">④</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Mas a <code>sorted()</code>função também pode ter uma função como parâmetro- <var>chave</var> e é classificada por essa chave. Nesse caso, a função de classificação é <code>len()</code>, portanto, ela classifica por . Nomes mais curtos vêm primeiro, depois mais longos, depois os mais longos.
<code>len(<var>each item</var>)</code></td></tr></tbody></table>
<p>O que isso tem a ver com o módulo <code>itertools</code>? Estou feliz que você perguntou.

</p><p class="skip"><a href="#postautopre9" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre9"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre9')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre9')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b">... continuando do shell interativo anterior ...
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">import</span><span class="pln"> itertools</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">groups </span><span class="pun">=</span><span class="pln"> itertools</span><span class="pun">.</span><span class="pln">groupby</span><span class="pun">(</span><span class="pln">names</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">)</span></kbd>  <span class="u">①</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">groups</span></kbd>
<samp class="pp"><span class="tag">&lt;itertools </span><span class="pln">. </span><span class="atn">groupby </span><span class="atn">objeto </span><span class="atn">em </span><span class="pln">0 </span><span class="atn">x00BB20C0 </span><span class="tag">&gt;</span><span class="pln"> </span><span class="atn"></span><span class="pln"> </span><span class="atn"></span><span class="pln"></span><span class="atn"></span><span class="tag"></span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">groups</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="pun">[( </span><span class="lit">4 </span><span class="pun">, </span><span class="pun">&lt; </span><span class="pln">itertools </span><span class="pun">. </span><span class="pln">_Grouper </span><span class="kwd">object </span><span class="pln">em </span><span class="lit">0x00BA8BF0 </span><span class="pun">&gt;), </span><span class="pun">( </span><span class="lit">5 </span><span class="pun">, </span><span class="pun">&lt; </span><span class="pln">itertools </span><span class="pun">. </span><span class="pln">_Grouper </span><span class="kwd">object </span><span class="pln">em </span><span class="lit">0x00BB4050 </span><span class="pun">&gt;), </span><span class="pun">( </span><span class="lit">6 </span><span class="pun">, </span><span class="pun">&lt; </span><span class="pln">itertools </span><span class="pun">. </span><span class="pln">_Grouper </span><span class="kwd">object </span><span class="pln">em </span><span class="lit">0x00BB4030 </span><span class="pun">&gt;)]</span><span class="pln"> </span><span class="pun"></span><span class="pln"></span><span class="pun"></span><span class="pln"></span><span class="kwd"></span><span class="pln"></span><span class="lit"></span><span class="pun"></span><span class="pln"><br/> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="pln"></span><span class="pun"></span><span class="pln"></span><span class="kwd"></span><span class="pln"></span><span class="lit"></span><span class="pun"></span><span class="pln"><br/> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="pln"></span><span class="pun"></span><span class="pln"></span><span class="kwd"></span><span class="pln"></span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">groups </span><span class="pun">=</span><span class="pln"> itertools</span><span class="pun">.</span><span class="pln">groupby</span><span class="pun">(</span><span class="pln">names</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">)</span></kbd>   <span class="u">②</span></a>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">for</span><span class="pln"> name_length</span><span class="pun">,</span><span class="pln"> name_iter </span><span class="kwd">in</span><span class="pln"> groups</span><span class="pun">:</span></kbd>    <span class="u">③</span></a>
<samp class="p">... </samp><kbd class="pp"><span class="pln">    </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Names with {0:d} letters:'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">name_length</span><span class="pun">))</span></kbd>
<samp class="p">... </samp><kbd class="pp"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> name </span><span class="kwd">in</span><span class="pln"> name_iter</span><span class="pun">:</span></kbd>
<samp class="p">... </samp><kbd class="pp"><span class="pln">        </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span></kbd>
<samp class="p">... </samp>
<samp>Nomes com 4 letras:
Alex
Anne
Dora
João
Mike
Nomes com 5 letras:
Chris
Ethan
Sarah
Nomes com 6 letras:
Lizzie
Wesley</samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A <code>itertools.groupby()</code>função recebe uma sequência e uma função-chave e retorna um iterador que gera pares. Cada par contém o resultado de e outro iterador contendo todos os itens que compartilharam aquele resultado chave.
<code>key_function(<var>each item</var>)</code></td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Chamar a função <code>list()</code> “exauriu” o iterador, <i>ou seja</i> , você já gerou todos os itens no iterador para fazer a lista. Não há botão “reset” em um iterador; você não pode simplesmente começar de novo depois de esgotá-lo. Se quiser fazer um loop por ele novamente (digamos, no próximo loop <code>for</code>), você precisa chamar <code>itertools.groupby()</code>novamente para criar um novo iterador.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Neste exemplo, dada uma lista de nomes <em>já classificados por comprimento</em> , <code>itertools.groupby(names, len)</code>colocará todos os nomes de 4 letras em um iterador, todos os nomes de 5 letras em outro iterador e assim por diante. A <code>groupby()</code>função é completamente genérica; ele poderia agrupar strings pela primeira letra, números por seu número de fatores ou qualquer outra função de tecla que você possa imaginar.
</td></tr></tbody></table>
<!-- YO DAWG, WE HEARD YOU LIKE LOOPING, SO WE PUT AN ITERATOR IN YOUR ITERATOR SO YOU CAN LOOP WHILE YOU LOOP. -->
<blockquote class="note">
<p><span class="u">☞</span>A <code>itertools.groupby()</code>função só funciona se a sequência de entrada já estiver classificada pela função de agrupamento. No exemplo acima, você agrupou uma lista de nomes pela <code>len()</code>função. Isso só funcionou porque a lista de entrada já estava classificada por tamanho.
</p></blockquote>
<p>Você está observando de perto?
</p><p class="skip"><a href="#postautopre10" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre10"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre10')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre10')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">))</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="lit">0 </span><span class="pun">, </span><span class="lit">1 </span><span class="pun">, </span><span class="lit">2 </span><span class="pun">]</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">))</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="lit">10 </span><span class="pun">, </span><span class="lit">11 </span><span class="pun">, </span><span class="lit">12 </span><span class="pun">]</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">itertools</span><span class="pun">.</span><span class="pln">chain</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">)))</span></kbd>        <span class="u">①</span></a>
<samp class="pp"><span class="pun">[ </span><span class="lit">0 </span><span class="pun">, </span><span class="lit">1 </span><span class="pun">, </span><span class="lit">2 </span><span class="pun">, </span><span class="lit">10 </span><span class="pun">, </span><span class="lit">11 </span><span class="pun">, </span><span class="lit">12 </span><span class="pun">]</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">)))</span></kbd>                    <span class="u">②</span></a>
<samp class="pp"><span class="pun">[( </span><span class="lit">0 </span><span class="pun">, </span><span class="lit">10 </span><span class="pun">), </span><span class="pun">( </span><span class="lit">1 </span><span class="pun">, </span><span class="lit">11 </span><span class="pun">), </span><span class="pun">( </span><span class="lit">2 </span><span class="pun">, </span><span class="lit">12 </span><span class="pun">)]</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)))</span></kbd>                    <span class="u">③</span></a>
<samp class="pp"><span class="pun">[( </span><span class="lit">0 </span><span class="pun">, </span><span class="lit">10 </span><span class="pun">), </span><span class="pun">( </span><span class="lit">1 </span><span class="pun">, </span><span class="lit">11 </span><span class="pun">), </span><span class="pun">( </span><span class="lit">2 </span><span class="pun">, </span><span class="lit">12 </span><span class="pun">)]</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">list</span><span class="pun">(</span><span class="pln">itertools</span><span class="pun">.</span><span class="pln">zip_longest</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)))</span></kbd>  <span class="u">④</span></a>
<samp class="pp"><span class="pun">[( </span><span class="lit">0 </span><span class="pun">, </span><span class="lit">10 </span><span class="pun">), </span><span class="pun">( </span><span class="lit">1 </span><span class="pun">, </span><span class="lit">11 </span><span class="pun">), </span><span class="pun">( </span><span class="lit">2 </span><span class="pun">, </span><span class="lit">12 </span><span class="pun">), </span><span class="pun">( </span><span class="kwd">Nenhum </span><span class="pun">, </span><span class="lit">13 </span><span class="pun">)]</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="kwd"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A <code>itertools.chain()</code>função pega dois iteradores e retorna um iterador que contém todos os itens do primeiro iterador, seguidos por todos os itens do segundo iterador. (Na verdade, ele pode levar qualquer número de iteradores e os encadeia na ordem em que foram passados ​​para a função.)
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A <code>zip()</code>função faz algo prosaico que acaba sendo extremamente útil: pega qualquer número de sequências e retorna um iterador que retorna tuplas dos primeiros itens de cada sequência, depois os segundos itens de cada uma, depois o terceiro e assim por diante.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A <code>zip()</code>função para no final da seqüência mais curta. <code>range(10, 14)</code>tem 4 itens (10, 11, 12 e 13), mas <code>range(0, 3)</code>tem apenas 3, portanto, a <code>zip()</code>função retorna um iterador de 3 itens.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">④</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Por outro lado, a <code>itertools.zip_longest()</code>função para no final da sequência <em>mais longa</em> , inserindo <code>None</code>valores para itens após o final das sequências mais curtas.
</td></tr></tbody></table>
<p id="dict-zip">OK, tudo isso foi muito interessante, mas como isso se relaciona com o solucionador de alfamética? Veja como:

</p><p class="skip"><a href="#postautopre11" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre11"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre11')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre11')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">characters </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="str">'S'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'M'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'D'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'O'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'N'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'R'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Y'</span><span class="pun">)</span></kbd>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">guess </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="str">'1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'5'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'6'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'7'</span><span class="pun">)</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">tuple</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">characters</span><span class="pun">,</span><span class="pln"> guess</span><span class="pun">))</span></kbd>  <span class="u">①</span></a>
<samp class="pp"><span class="pun">(( </span><span class="str">'S' </span><span class="pun">, </span><span class="str">'1' </span><span class="pun">), </span><span class="pun">( </span><span class="str">'M' </span><span class="pun">, </span><span class="str">'2' </span><span class="pun">), </span><span class="pun">( </span><span class="str">'E' </span><span class="pun">, </span><span class="str">'0' </span><span class="pun">), </span><span class="pun">( </span><span class="str">'D' </span><span class="pun">, </span><span class="str">'3' </span><span class="pun">), </span><span class="pun">( </span><span class="str">'O' </span><span class="pun">, </span><span class="str">'4' </span><span class="pun">) , </span><span class="pun">( </span><span class="str">'N' </span><span class="pun">, </span><span class="str">'5' </span><span class="pun">), </span><span class="pun">( </span><span class="str">'R' </span><span class="pun">, </span><span class="str">'6' </span><span class="pun">), </span><span class="pun">( </span><span class="str">'Y' </span><span class="pun">, </span><span class="str">'7' </span><span class="pun">))</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"><br/> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">dict</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">characters</span><span class="pun">,</span><span class="pln"> guess</span><span class="pun">))</span></kbd>   <span class="u">②</span></a>
<samp class="pp"><span class="pun">{ </span><span class="str">'E' </span><span class="pun">: </span><span class="str">'0' </span><span class="pun">, </span><span class="str">'D' </span><span class="pun">: </span><span class="str">'3' </span><span class="pun">, </span><span class="str">'M' </span><span class="pun">: </span><span class="str">'2' </span><span class="pun">, </span><span class="str">'O' </span><span class="pun">: </span><span class="str">'4' </span><span class="pun">, </span><span class="str">'N' </span><span class="pun">: </span><span class="str">'5' </span><span class="pun">, </span><span class="str">'S' </span><span class="pun">: </span><span class="str">'1' </span><span class="pun">, </span><span class="str">' R ' </span><span class="pun">: </span><span class="str">' 6 ' </span><span class="pun">, </span><span class="str">' Y ' </span><span class="pun">: </span><span class="str">' 7 ' </span><span class="pun">}</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"><br/> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Dada uma lista de letras e uma lista de dígitos (cada um representado aqui como cadeias de 1 caractere), a <code>zip</code>função criará um par de letras e dígitos, em ordem.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Por que isso é legal? Porque essa estrutura de dados é exatamente a estrutura certa para passar para a <code>dict()</code>função de criar um dicionário que usa letras como chaves e seus dígitos associados como valores. (Esta não é a única maneira de fazer isso, é claro. Você poderia usar uma <a href="https://www.acervolima.com.br/2021/05/compreensoes-de-listas-dicionarios-e.html#dictionarycomprehension" style="color: #b44582;">compreensão de dicionário</a> para criar o dicionário diretamente.) Embora a representação impressa do dicionário liste os pares em uma ordem diferente (os dicionários não têm "ordem" por se), você pode ver que cada letra está associada ao dígito, com base na ordem dos <var>caracteres</var> originais e nas sequências de <var>adivinhação</var> .
</td></tr></tbody></table>
<p id="guess">O solucionador de alfamética usa essa técnica para criar um dicionário que mapeia as letras do quebra-cabeça em dígitos na solução, para cada solução possível.

</p><pre class="nd pp code"><code><span class="pln">characters </span><span class="pun">=</span><span class="pln"> tuple</span><span class="pun">(</span><span class="pln">ord</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> c </span><span class="kwd">in</span><span class="pln"> sorted_characters</span><span class="pun">)</span><span class="pln"><br/>digits </span><span class="pun">=</span><span class="pln"> tuple</span><span class="pun">(</span><span class="pln">ord</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> c </span><span class="kwd">in</span><span class="pln"> </span><span class="str">'0123456789'</span><span class="pun">)</span><span class="pln"><br/></span><span class="pun">...</span><span class="pln"><br/></span><span class="kwd">for</span><span class="pln"> guess </span><span class="kwd">in</span><span class="pln"> itertools</span><span class="pun">.</span><span class="pln">permutations</span><span class="pun">(</span><span class="pln">digits</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">characters</span><span class="pun">)):</span><span class="pln"><br/>    </span><span class="pun">...</span><span class="pln"><br/></span><mark><span class="pln">    equation </span><span class="pun">=</span><span class="pln"> puzzle</span><span class="pun">.</span><span class="pln">translate</span><span class="pun">(</span><span class="pln">dict</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">characters</span><span class="pun">,</span><span class="pln"> guess</span><span class="pun">)))</span></mark></code></pre>
<p>Mas qual é esse <code>translate()</code>método? Ah, agora você está chegando à parte <em>realmente</em> divertida.

</p><p class="a">⁂

</p><h2 id="string-translate">Um novo tipo de manipulação de cordas <a class="hl" href="#string-translate" style="color: #b44582;">#</a></h2>
<p>As strings Python têm muitos métodos. Você aprendeu sobre alguns desses métodos no <a href="https://www.acervolima.com.br/2021/05/strings-em-python-3.html" style="color: #b44582;">capítulo Cordas</a> : <code>lower()</code>, <code>count()</code>, e <code>format()</code>. Agora, quero apresentar a você uma técnica de manipulação de strings poderosa, mas pouco conhecida: o <code>translate()</code>método.

</p><p class="skip"><a href="#postautopre12" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre12"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre12')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre12')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">translation_table </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">ord</span><span class="pun">(</span><span class="str">'A'</span><span class="pun">):</span><span class="pln"> ord</span><span class="pun">(</span><span class="str">'O'</span><span class="pun">)}</span></kbd>  <span class="u">①</span></a>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">translation_table</span></kbd>                         <span class="u">②</span></a>
<samp class="pp"><span class="pun">{ </span><span class="lit">65 </span><span class="pun">: </span><span class="lit">79 </span><span class="pun">}</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="str">'MARK'</span><span class="pun">.</span><span class="pln">translate</span><span class="pun">(</span><span class="pln">translation_table</span><span class="pun">)</span></kbd>       <span class="u">③</span></a>
<samp class="pp"><span class="str">'MORK'</span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A tradução de strings começa com uma tabela de tradução, que é apenas um dicionário que mapeia um caractere para outro. Na verdade, “caractere” está incorreto - a tabela de tradução realmente mapeia um <em>byte</em> para outro.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Lembre-se de que bytes em Python 3 são inteiros. A <code>ord()</code>função retorna o valor <abbr>ASCII</abbr> de um caractere, que, no caso de A – Z, é sempre um byte de 65 a 90.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">O <code>translate()</code>método em uma string pega uma tabela de tradução e executa a string nela. Ou seja, ele substitui todas as ocorrências das chaves da tabela de tradução pelos valores correspondentes. Nesse caso, “traduzindo” <code>MARK</code>para <code>MORK</code>.
</td></tr></tbody></table>
<aside>Agora você está chegando à parte <em>realmente</em> divertida.</aside>
<p>O que isso tem a ver com a resolução de quebra-cabeças alfaméticos? Acontece que tudo.

</p><p class="skip"><a href="#postautopre13" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre13"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre13')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre13')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">characters </span><span class="pun">=</span><span class="pln"> tuple</span><span class="pun">(</span><span class="pln">ord</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> c </span><span class="kwd">in</span><span class="pln"> </span><span class="str">'SMEDONRY'</span><span class="pun">)</span></kbd>       <span class="u">①</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">characters</span></kbd>
<samp class="pp"><span class="pun">( </span><span class="lit">83 </span><span class="pun">, </span><span class="lit">77 </span><span class="pun">, </span><span class="lit">69 </span><span class="pun">, </span><span class="lit">68 </span><span class="pun">, </span><span class="lit">79 </span><span class="pun">, </span><span class="lit">78 </span><span class="pun">, </span><span class="lit">82 </span><span class="pun">, </span><span class="lit">89 </span><span class="pun">)</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">guess </span><span class="pun">=</span><span class="pln"> tuple</span><span class="pun">(</span><span class="pln">ord</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> c </span><span class="kwd">in</span><span class="pln"> </span><span class="str">'91570682'</span><span class="pun">)</span></kbd>            <span class="u">②</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">guess</span></kbd>
<samp class="pp"><span class="pun">( </span><span class="lit">57 </span><span class="pun">, </span><span class="lit">49 </span><span class="pun">, </span><span class="lit">53 </span><span class="pun">, </span><span class="lit">55 </span><span class="pun">, </span><span class="lit">48 </span><span class="pun">, </span><span class="lit">54 </span><span class="pun">, </span><span class="lit">56 </span><span class="pun">, </span><span class="lit">50 </span><span class="pun">)</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">translation_table </span><span class="pun">=</span><span class="pln"> dict</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">characters</span><span class="pun">,</span><span class="pln"> guess</span><span class="pun">))</span></kbd>     <span class="u">③</span></a>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">translation_table</span></kbd>
<samp class="pp"><span class="pun">{ </span><span class="lit">68 </span><span class="pun">: </span><span class="lit">55 </span><span class="pun">, </span><span class="lit">69 </span><span class="pun">: </span><span class="lit">53 </span><span class="pun">, </span><span class="lit">77 </span><span class="pun">: </span><span class="lit">49 </span><span class="pun">, </span><span class="lit">78 </span><span class="pun">: </span><span class="lit">54 </span><span class="pun">, </span><span class="lit">79 </span><span class="pun">: </span><span class="lit">48 </span><span class="pun">, </span><span class="lit">82 </span><span class="pun">: </span><span class="lit">56 </span><span class="pun">, </span><span class="lit">83 </span><span class="pun">: </span><span class="lit">57 </span><span class="pun">, </span><span class="lit">89 </span><span class="pun">: </span><span class="lit">50 </span><span class="pun">}</span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span><span class="pln"> </span><span class="lit"></span><span class="pun"></span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="str">'SEND + MORE == MONEY'</span><span class="pun">.</span><span class="pln">translate</span><span class="pun">(</span><span class="pln">translation_table</span><span class="pun">)</span></kbd>  <span class="u">④</span></a>
<samp class="pp"><span class="str">'9567 + 1085 == 10652'</span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Usando uma <a href="#generator-expressions" style="color: #b44582;">expressão geradora</a> , calculamos rapidamente os valores de byte para cada caractere em uma string. <var>caracteres</var> é um exemplo do valor de <var>ordenados_caracteres</var> na <code>alphametics.solve()</code>função.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Usando outra expressão geradora, calculamos rapidamente os valores de byte para cada dígito nesta string. O resultado, <var>adivinha</var> , está no formato <a href="#guess" style="color: #b44582;">retornado pela <code>itertools.permutations()</code>função</a> na <code>alphametics.solve()</code>função.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Esta tabela de tradução é gerada <a href="#dict-zip" style="color: #b44582;">compactando os <var>caracteres</var> e <var>supondo</var> juntos</a> e construindo um dicionário a partir da sequência de pares resultante. Isso é exatamente o que a <code>alphametics.solve()</code>função faz dentro do loop <code>for</code>.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">④</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Finalmente, passamos esta tabela de tradução para o <code>translate()</code>método da string original do quebra-cabeça. Isso converte cada letra da string no dígito correspondente (com base nas letras em <var>caracteres</var> e nos dígitos em <var>suposições</var> ). O resultado é uma expressão Python válida, como uma string.
</td></tr></tbody></table>
<p>Isso é impressionante. Mas o que você pode fazer com uma string que é uma expressão válida do Python?

</p><p class="a">⁂

</p><h2 id="eval">Avaliando strings arbitrárias como expressões Python <a class="hl" href="#eval" style="color: #b44582;">#</a></h2>
<p>Esta é a peça final do quebra-cabeça (ou melhor, a peça final do solucionador de quebra-cabeça). Depois de toda aquela manipulação de string sofisticada, ficamos com uma string parecida com <code>'9567 + 1085 == 10652'</code>. Mas isso é uma corda, e para que serve uma corda? Enter <code>eval()</code>, a ferramenta de avaliação universal do Python.

</p><pre class="nd screen"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'1 + 1 == 2'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="kwd">Verdadeiro</span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'1 + 1 == 3'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="kwd">Falso</span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'9567 + 1085 == 10652'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="kwd">Verdadeiro</span></samp></pre>
<p>Mas espere, tem mais! A <code>eval()</code>função não se limita a expressões booleanas. Ele pode lidar com <em>qualquer</em> expressão Python e retorna <em>qualquer</em> tipo de dados.

</p><pre class="nd screen"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'"A" + "B"'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="str">'AB'</span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'"MARK".translate({65: 79})'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="str">'MORK'</span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'"AAAAA".count("A")'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="lit">5</span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">'["*"] * 5'</span><span class="pun">)</span></kbd>
<samp class="pp"><span class="pun">[ </span><span class="str">'*' </span><span class="pun">, </span><span class="str">'*' </span><span class="pun">, </span><span class="str">'*' </span><span class="pun">, </span><span class="str">'*' </span><span class="pun">, </span><span class="str">'*' </span><span class="pun">]</span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span><span class="pln"> </span><span class="str"></span><span class="pun"></span></samp></pre>
<p>Mas espere, isso não é tudo!

</p><p class="skip"><a href="#postautopre14" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre14"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre14')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre14')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"x * 5"</span><span class="pun">)</span></kbd>         <span class="u">①</span></a>
<samp class="pp"><span class="lit">25</span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"pow(x, 2)"</span><span class="pun">)</span></kbd>     <span class="u">②</span></a>
<samp class="pp"><span class="lit">25</span></samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">import</span><span class="pln"> math</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"math.sqrt(x)"</span><span class="pun">)</span></kbd>  <span class="u">③</span></a>
<samp class="pp"><span class="lit">2.2360679774997898</span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">A expressão que <code>eval()</code>leva pode fazer referência a variáveis ​​globais definidas fora do <code>eval()</code>. Se chamado dentro de uma função, ele também pode fazer referência a variáveis ​​locais.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">E funções.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">E módulos.
</td></tr></tbody></table>
<p>Ei, espere um minuto ...

</p><p class="skip"><a href="#postautopre15" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre15"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre15')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre15')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">import</span><span class="pln"> subprocess</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"subprocess.getoutput('ls ~')"</span><span class="pun">)</span></kbd>                  <span class="u">①</span></a>
<samp class="pp"><span class="str">'Imagens da biblioteca da área de trabalho \ <br/> Documentos, filmes públicos \ <br/> Sites de música'</span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"subprocess.getoutput('rm /some/random/file')"</span><span class="pun">)</span></kbd>  <span class="u">②</span></a></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">O <code>subprocess</code>módulo permite que você execute comandos de shell arbitrários e obtenha o resultado como uma string Python.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Comandos de shell arbitrários podem ter consequências permanentes.
</td></tr></tbody></table>
<p>É ainda pior do que isso, porque há uma <code>__import__()</code>função global que recebe um nome de módulo como uma string, importa o módulo e retorna uma referência a ele. Combinado com o poder do <code>eval()</code>, você pode construir uma única expressão que apagará todos os seus arquivos:

</p><p class="skip"><a href="#postautopre16" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre16"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre16')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre16')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"__import__('subprocess').getoutput('rm /some/random/file')"</span><span class="pun">)</span></kbd>  <span class="u">①</span></a></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Agora imagine a saída de <code>'rm -rf ~'</code>. Na verdade, não haveria saída, mas você também não teria arquivos restantes.
</td></tr></tbody></table>
<p class="xxxl">eval () é EVIL

</p><p>Bem, a parte má é avaliar expressões arbitrárias de fontes não confiáveis. Você só deve usar uma <code>eval()</code>entrada confiável. Claro, o truque é descobrir o que é "confiável". Mas aqui está algo que eu sei com certeza: você <b>NÃO</b> deve pegar este solucionador de alfamética e colocá-lo na internet como um pequeno serviço da web divertido. Não cometa o erro de pensar: “Nossa, a função faz muitas manipulações de strings antes de fazer com que uma string seja avaliada; <em>Não consigo imaginar</em> como alguém poderia explorar isso. ” Alguém <b>VAI</b> descobrir como passar furtivamente o código executável desagradável por toda aquela manipulação de string ( <a href="http://www.securityfocus.com/blogs/746" style="color: #b44582;">coisas estranhas aconteceram</a> ), e então você pode dar adeus ao seu servidor.

</p><p>Mas certamente há <em>alguma</em> maneira de avaliar as expressões com segurança? Colocar <code>eval()</code>em uma caixa de areia onde não possa acessar ou prejudicar o mundo exterior? Bem, sim e não.

</p><p class="skip"><a href="#postautopre17" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre17"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre17')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre17')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"x * 5"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="pun">{})</span></kbd>               <span class="u">①</span></a>
<samp class="traceback">Traceback (última chamada mais recente):
  Arquivo "&lt;stdin&gt;", linha 1, em &lt;module&gt;
  Arquivo "&lt;string&gt;", linha 1, em &lt;module&gt;
NameError: o nome 'x' não está definido</samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"x * 5"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="str">"x"</span><span class="pun">:</span><span class="pln"> x</span><span class="pun">},</span><span class="pln"> </span><span class="pun">{})</span></kbd>         <span class="u">②</span></a>
<samp class="p">25</samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">import</span><span class="pln"> math</span></kbd>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"math.sqrt(x)"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="str">"x"</span><span class="pun">:</span><span class="pln"> x</span><span class="pun">},</span><span class="pln"> </span><span class="pun">{})</span></kbd>  <span class="u">③</span></a>
<samp class="traceback">Traceback (última chamada mais recente):
  Arquivo "&lt;stdin&gt;", linha 1, em &lt;module&gt;
  Arquivo "&lt;string&gt;", linha 1, em &lt;module&gt;
NameError: o nome 'matemática' não está definido</samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">O segundo e o terceiro parâmetros passados ​​para a <code>eval()</code>função atuam como os namespaces globais e locais para avaliar a expressão. Nesse caso, eles estão vazios, o que significa que quando a string <code>"x * 5"</code>é avaliada, não há referência a <var>x</var> no namespace global ou local, portanto, <code>eval()</code>lança uma exceção.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Você pode incluir seletivamente valores específicos no namespace global, listando-os individualmente. Então, essas - e apenas essas - variáveis ​​estarão disponíveis durante a avaliação.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">③</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Mesmo que você tenha acabado de importar o <code>math</code>módulo, você não o incluiu no namespace passado para a <code>eval()</code>função, portanto, a avaliação falhou.
</td></tr></tbody></table>
<p>Puxa, isso foi fácil. Deixe-me fazer um serviço da web sobre alfamética agora!

</p><p class="skip"><a href="#postautopre18" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre18"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre18')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre18')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"pow(5, 2)"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="pun">{})</span></kbd>                   <span class="u">①</span></a>
<samp class="pp"><span class="lit">25</span></samp>
<a style="color: #b44582;"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"__import__('math').sqrt(5)"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="pun">{})</span></kbd>  <span class="u">②</span></a>
<samp class="pp"><span class="lit">2.2360679774997898</span></samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align: top; margin: 0px; padding: 0px; width: auto; border: 0px none; background-color: inherit; cursor: inherit;">Mesmo que você tenha passado dicionários vazios para os namespaces globais e locais, todas as funções integradas do Python ainda estão disponíveis durante a avaliação. Então <code>pow(5, 2)</code>funciona, porque <code>5</code>e <code>2</code>são literais, e <code>pow()</code>é uma função embutida.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Infelizmente (e se você não vê por que é lamentável, continue lendo), a <code>__import__()</code>função também é uma função embutida, por isso também funciona.
</td></tr></tbody></table>
<p>Sim, isso significa que você ainda pode fazer coisas desagradáveis, mesmo se definir explicitamente os namespaces globais e locais para dicionários vazios ao chamar <code>eval()</code>:

</p><pre class="nd screen"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"__import__('subprocess').getoutput('rm /some/random/file')"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="pun">{})</span></kbd></pre>
<p>Opa. Estou feliz por não ter criado aquele serviço da web sobre alfamética. Existe <em>alguma</em> maneira de usar <code>eval()</code>com segurança? Bem, sim e não.

</p><p class="skip"><a href="#postautopre19" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre19"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre19')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre19')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"__import__('math').sqrt(5)"</span><span class="pun">,</span></kbd>
<a style="color: #b44582;"><samp class="p">... </samp><kbd class="pp"><span class="pln">    </span><span class="pun">{</span><span class="str">"__builtins__"</span><span class="pun">:</span><span class="kwd">None</span><span class="pun">},</span><span class="pln"> </span><span class="pun">{})</span></kbd>          <span class="u">①</span></a>
<samp class="traceback">Traceback (última chamada mais recente):
  Arquivo "&lt;stdin&gt;", linha 1, em &lt;module&gt;
  Arquivo "&lt;string&gt;", linha 1, em &lt;module&gt;
NameError: o nome '__import__' não está definido</samp>
<samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"__import__('subprocess').getoutput('rm -rf /')"</span><span class="pun">,</span></kbd>
<a style="color: #b44582;"><samp class="p">... </samp><kbd class="pp"><span class="pln">    </span><span class="pun">{</span><span class="str">"__builtins__"</span><span class="pun">:</span><span class="kwd">None</span><span class="pun">},</span><span class="pln"> </span><span class="pun">{})</span></kbd>          <span class="u">②</span></a>
<samp class="traceback">Traceback (última chamada mais recente):
  Arquivo "&lt;stdin&gt;", linha 1, em &lt;module&gt;
  Arquivo "&lt;string&gt;", linha 1, em &lt;module&gt;
NameError: o nome '__import__' não está definido</samp></div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Para avaliar expressões não confiáveis ​​com segurança, você precisa definir um dicionário de namespace global que mapeie <code>"__builtins__"</code>para <code>None</code>o valor nulo do Python. Internamente, as funções “embutidas” estão contidas em um pseudo-módulo chamado <code>"__builtins__"</code>. Este pseudo-módulo ( <i>isto é,</i> o conjunto de funções embutidas) é disponibilizado para expressões avaliadas, a menos que você o substitua explicitamente.
</td></tr><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">②</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Certifique-se de que você substituiu <code>__builtins__</code>. Não <code>__builtin__</code>, <code>__built-ins__</code>ou alguma outra variação que funcione bem, mas o exponha a riscos catastróficos.
</td></tr></tbody></table>
<p>Então, <code>eval()</code>está seguro agora? Bem, sim e não.

</p><p class="skip"><a href="#postautopre20" style="color: #b44582;">pule esta lista de códigos</a></p><pre class="screen" id="autopre20"><div class="w">[ <a class="toggle" href="javascript:toggleCodeBlock('autopre20')" style="color: #b44582;">ocultar</a> ] [ <a href="javascript:plainTextOnClick('autopre20')" style="color: #b44582;">abrir em uma nova janela</a> ]</div><div class="b"><samp class="p">&gt;&gt;&gt; </samp><kbd class="pp"><span class="kwd">eval</span><span class="pun">(</span><span class="str">"2 ** 2147483647"</span><span class="pun">,</span></kbd>
<a style="color: #b44582;"><samp class="p">... </samp><kbd class="pp"><span class="pln">    </span><span class="pun">{</span><span class="str">"__builtins__"</span><span class="pun">:</span><span class="kwd">None</span><span class="pun">},</span><span class="pln"> </span><span class="pun">{})</span></kbd>          <span class="u">①</span></a>
</div></pre>
<table style="width:100%;border-collapse:collapse;margin:0;border:0"><tbody><tr><td style="text-align:center;vertical-align:baseline;margin:0;padding:0;width:2em;border:0"><span class="u">①</span></td><td style="vertical-align:top;margin:0;padding:0;width:auto;border:0">Mesmo sem acesso ao <code>__builtins__</code>, você ainda pode lançar um ataque de negação de serviço. Por exemplo, tentar aumentar <code>2</code>para a <code>2147483647</code><sup>enésima</sup> potência aumentará a utilização da <abbr>CPU</abbr> do servidor para 100% por algum tempo. (Se você está tentando isso no shell interativo, pressione <kbd>Ctrl-C</kbd>algumas vezes para sair dela.) Tecnicamente esta expressão <em>irá</em> retornar um valor, eventualmente, mas, entretanto, o seu servidor vai estar fazendo um monte de nada.
</td></tr></tbody></table>
<p>No final, <em>é</em> possível avaliar com segurança expressões Python não confiáveis, para alguma definição de “seguro” que acaba não sendo terrivelmente útil na vida real. Tudo bem se você estiver apenas brincando e se você apenas transmitir informações confiáveis. Mas qualquer outra coisa é apenas procurar encrenca.

</p><p class="a">⁂

</p><h2 id="alphametics-finale">Juntando tudo <a class="hl" href="#alphametics-finale" style="color: #b44582;">#</a></h2>
<p>Para recapitular: este programa resolve quebra-cabeças alfaméticos por força bruta, <i>ou seja</i> , por meio de uma busca exaustiva de todas as soluções possíveis. Para fazer isso ...

</p><ol>
<li><a href="#re-findall" style="color: #b44582;">Encontra todas as letras do quebra</a> - <a href="#re-findall" style="color: #b44582;">cabeça</a> com a <code>re.findall()</code>função
</li><li><a href="#unique-items" style="color: #b44582;">Encontre todas as letras <em>únicas</em> no quebra</a> - <a href="#unique-items" style="color: #b44582;">cabeça</a> com conjuntos e a <code>set()</code>função
</li><li><a href="#assert" style="color: #b44582;">Verifica se há mais de 10 letras exclusivas</a> (o que significa que o quebra-cabeça é definitivamente insolúvel) com uma <code>assert</code>declaração
</li><li><a href="#generator-objects" style="color: #b44582;">Converte as letras em seus equivalentes ASCII</a> com um objeto gerador
</li><li><a href="#permutations" style="color: #b44582;">Calcula todas as soluções possíveis</a> com a <code>itertools.permutations()</code>função
</li><li><a href="#string-translate" style="color: #b44582;">Converte cada solução possível em uma expressão Python</a> com o <code>translate()</code>método string
</li><li><a href="#eval" style="color: #b44582;">Testa cada solução possível avaliando a expressão Python</a> com a <code>eval()</code>função
</li><li>Retorna a primeira solução que avalia para <code>True</code>
</li></ol>
<p>… Em apenas 14 linhas de código.

</p><p class="a">⁂

</p><h2 id="furtherreading">Leitura Adicional <a class="hl" href="#furtherreading" style="color: #b44582;">#</a></h2>
<ul>
<li><a href="http://docs.python.org/3.1/library/itertools.html" style="color: #b44582;"><code>itertools</code> módulo</a>
</li><li><a href="http://www.doughellmann.com/PyMOTW/itertools/" style="color: #b44582;"><code>itertools</code> - Funções de iterador para looping eficiente</a>
</li><li><a href="http://blip.tv/file/1947373/" style="color: #b44582;">Assista</a> à <a href="http://blip.tv/file/1947373/" style="color: #b44582;">palestra “Easy AI with Python” de Raymond Hettinger</a> na PyCon 2009
</li><li><a href="http://code.activestate.com/recipes/576615/" style="color: #b44582;">Receita 576615: solucionador de alfamética</a> , <a href="http://code.activestate.com/recipes/576615/" style="color: #b44582;">solucionador de alfamética</a> original de Raymond Hettinger para Python 2
</li><li><a href="http://code.activestate.com/recipes/users/178123/" style="color: #b44582;">Mais receitas de Raymond Hettinger</a> no repositório ActiveState Code
</li><li><a href="http://en.wikipedia.org/wiki/Verbal_arithmetic" style="color: #b44582;">Alfamética na Wikipedia</a>
</li><li><a href="http://www.tkcs-collins.com/truman/alphamet/index.shtml" style="color: #b44582;">Índice Alphametics</a> , incluindo <a href="http://www.tkcs-collins.com/truman/alphamet/alphamet.shtml" style="color: #b44582;">muitos quebra</a> - <a href="http://www.tkcs-collins.com/truman/alphamet/alphamet.shtml" style="color: #b44582;">cabeças</a> e <a href="http://www.tkcs-collins.com/truman/alphamet/alpha_gen.shtml" style="color: #b44582;">um gerador para fazer o seu próprio</a>
</li></ul>
<p>Muito obrigado a Raymond Hettinger por concordar em relicenciar seu código para que eu pudesse portá-lo para Python 3 e usá-lo como base para este capítulo.

</p>


<p>
     Esse artigo é uma tradução de um capítulo do livro "Dive Into Python 3" escrito por Mark Pilgrim. Você pode ler o livro desde o início em português clicando <a href="https://www.acervolima.com.br/2021/05/o-que-ha-de-novo-em-dive-into-python-3.html">aqui</a>.
</p>
<p>
    Traduzido por Acervo Lima. O original pode ser acessado <a href="https://diveintopython3.problemsolving.io/advanced-https://www.acervolima.com.br/2021/05/classes-e-iteradores-em-python.html" target="_blank">aqui</a>.
</p>
<h2>Licença</h2>
<ul>
    <li><a href="http://creativecommons.org/licenses/by-sa/3.0/" target="_blank">Creative Commons Attribution Share-Alike</a></li>
</ul>

<div class="prev-next-div">
    <a class="prev" href="#">&lt;&lt; Anterior</a>
    <a class="next" href="#">Próximo &gt;&gt;</a>
</div>



</body>
</html>
